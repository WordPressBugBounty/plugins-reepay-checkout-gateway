jQuery((function(a){const t=a(".migration-mobilepay-to-vippsmobile-wrap"),e=t.find(".spinners_warp"),i=t.find(".result");function s(t,o){a.ajax({url:ajaxurl,type:"POST",data:{action:"reepay_migration_process_batch",offset:t},success:function(n){if(n.success){var r=n.data.processed/o*100;a(".processing-percentage").html(r.toFixed(0)+"%"),n.data.batch_results.some((function(a){return"fail"===a.status}))||i.append("<p>"+migrationData.processed_success+"</p>"),n.data.batch_results.forEach((function(a){if("fail"===a.status){const t=a.item.filter((a=>a)).map((a=>a)).join("<br>");i.append(`<p style="border-bottom:1px solid #ccc; padding-bottom:10px; margin-bottom: 10px;">\n                                <strong>Failed Item:</strong><br>${t}<br>\n                                <strong>Message:</strong> <span style="color:red;">${a.message}</span></p>`)}})),n.data.has_more?s(t+10,o):(a(".processing-percentage").html("0%"),a(".start-migration").prop("disabled",!1),a("#migration_file").val(""),e.hide())}else alert(migrationData.processed_failed)}})}i.html(""),t.on("change","#migration_file",(function(t){i.html("");const e=a(this),s=e[0].files[0];s&&s.name.endsWith(".csv")||(i.html(migrationData.upload_csv),e.val(""))})),t.on("click",".start-migration",(function(t){if(t.preventDefault(),i.html(""),!confirm(migrationData.confirm_migration))return;const o=a("#migration_file"),n=a(this);if(o.val()){n.prop("disabled",!0),e.show();var r=new FormData;r.append("action","reepay_migration_upload_csv"),r.append("migration_file",a("#migration_file")[0].files[0]),a.ajax({url:ajaxurl,type:"POST",data:r,processData:!1,contentType:!1,success:function(a){a.success?s(0,a.data.total_records):alert(migrationData.failed_upload)}})}else alert(migrationData.choose_file)}))}));